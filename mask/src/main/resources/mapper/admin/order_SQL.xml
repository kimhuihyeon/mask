<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminOrder">
	
	<select id="selectOrderList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT A.ORDER_NUM, A.MEM_NUM, B.MEM_NAME , D.AORDER_STATE, E.GOODS_NAME , E.GOODS_CATEGORY, A.ORDER_DATE, A.ORDER_PAY, C.GOODS_AMOUNT 
			FROM MK_ORDER A,MEMBER B,GOODS_BASKET C , ADMIN_ORDER D , GOODS E
			WHERE A.MEM_NUM=B.MEM_NUM AND A.ORDER_NUM=C.ORDER_NUM AND A.ORDER_NUM = D.ORDER_NUM AND E.GOODS_NUM=C.GOODS_NUM
			AND A.ORDER_PAY LIKE #{Select_ORDER_PAY} AND D.AORDER_STATE LIKE #{Select_AORDER_STATE}
			ORDER BY A.ORDER_NUM DESC	
		]]>
	</select>
	
	<select id="selectDeliveryList" resultType="hashmap">
		<![CDATA[
			SELECT  TO_CHAR(A.ORDER_DATE,'YYYY-MM-DD') AS ORDER_DATE, A.ORDER_NUM, B.MEM_NAME , D.AORDER_TRACKING, D.AORDER_TRA_COM, D.ORDER_REPORT_COMMENT, TO_CHAR(D.AS_SDATE,'YYYY-MM-DD') AS AS_SDATE,  TO_CHAR(D.AS_EDATE,'YYYY-MM-DD') AS AS_EDATE, D.AORDER_STATE AORDER_STATE
			FROM MK_ORDER A,MEMBER B,GOODS_BASKET C , ADMIN_ORDER D , GOODS E
			WHERE A.MEM_NUM=B.MEM_NUM AND A.ORDER_NUM=C.ORDER_NUM AND A.ORDER_NUM = D.ORDER_NUM AND E.GOODS_NUM=C.GOODS_NUM AND D.AORDER_STATE != '무통장입금전'
			ORDER BY A.ORDER_DATE DESC
			
			
			
		]]>		
	</select>
	
	<update id="OrderStateUpdate" parameterType="hashmap">
		<![CDATA[
			UPDATE ADMIN_ORDER SET AORDER_STATE = #{AORDER_STATE} WHERE ORDER_NUM =#{ORDER_NUM}
		]]>
	</update>
	
	<select id="OrderSearchList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT A.ORDER_NUM, A.MEM_NUM, B.MEM_NAME , D.AORDER_STATE, E.GOODS_NAME , E.GOODS_CATEGORY, A.ORDER_DATE, A.ORDER_PAY, C.GOODS_AMOUNT 
			FROM MK_ORDER A,MEMBER B,GOODS_BASKET C , ADMIN_ORDER D , GOODS E
			WHERE A.MEM_NUM=B.MEM_NUM AND A.ORDER_NUM=C.ORDER_NUM AND A.ORDER_NUM = D.ORDER_NUM AND E.GOODS_NUM=C.GOODS_NUM AND ${name}=#{value}
			ORDER BY A.ORDER_NUM DESC
		]]>
	</select>
	
	<update id="deliverUpdate" parameterType="hashmap">
		<![CDATA[
			UPDATE ADMIN_ORDER SET AORDER_TRA_COM=#{AORDER_TRA_COM} , ORDER_REPORT_COMMENT=#{ORDER_REPORT_COMMENT} , AS_SDATE=#{AS_SDATE}, AS_EDATE=#{AS_EDATE}, AORDER_TRACKING=#{AORDER_TRACKING}, AORDER_STATE=#{AORDER_STATE}
			WHERE ORDER_NUM=#{ORDER_NUM}
		]]>
	</update>
	
	<select id="addressUpdateSelect" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT ORDER_NUM ,ORDER_USER_NAME , ORDER_DZIPCODE , ORDER_DADD1 , ORDER_DADD2 ,ORDER_PHONE
			FROM MK_ORDER
			WHERE ORDER_NUM = #{ORDER_NUM}
		]]>
	</select>
	
	<update id="deliverAddressUpdate" parameterType="hashmap">
		<![CDATA[
			UPDATE MK_ORDER 
			SET ORDER_USER_NAME=#{ORDER_USER_NAME} , ORDER_DZIPCODE =#{ORDER_DZIPCODE}, ORDER_DADD1=#{ORDER_DADD1}, ORDER_DADD2=#{ORDER_DADD2}, ORDER_PHONE=#{ORDER_PHONE}
			WHERE ORDER_NUM=#{ORDER_NUM}
		]]>
	</update>
	
	<select id="adminSalList" resultType="hashmap">
		<![CDATA[
			SELECT C.GOODS_NAME GOODS_NAME, SUM(A.ORDER_PRICE) TOT_ORDER_PRICE, SUM(A.ORDER_DCOST) TOT_ORDER_DCOST, SUM(C.GOODS_CPRICE*B.GOODS_AMOUNT) TOT_GOODS_CPRICE, SUM(A.ORDER_PRICE-(C.GOODS_CPRICE*B.GOODS_AMOUNT)) TOT_SUM, sum(B.GOODS_AMOUNT) CNT
		FROM MK_ORDER A, GOODS_BASKET B, GOODS C, ADMIN_ORDER D
		WHERE A.ORDER_NUM=B.ORDER_NUM AND B.GOODS_NUM =C.GOODS_NUM AND D.ORDER_NUM = A.ORDER_NUM AND D.AORDER_STATE ='구매확정'
		GROUP BY C.GOODS_NAME
		]]>
	</select>
	
	<select id="adminSalListOrderPay" parameterType="hashmap" resultType="hashmap">
		SELECT 
	  		C.GOODS_NAME GOODS_NAME, 
	  		SUM(A.ORDER_PRICE) TOT_ORDER_PRICE, 
	  		SUM(A.ORDER_DCOST) TOT_ORDER_DCOST, 
	  		SUM(C.GOODS_CPRICE*B.GOODS_AMOUNT) TOT_GOODS_CPRICE, 
	  		SUM(A.ORDER_PRICE-(C.GOODS_CPRICE*B.GOODS_AMOUNT)) TOT_SUM,
	  		SUM(B.GOODS_AMOUNT) CNT
	  FROM MK_ORDER A, GOODS_BASKET B, GOODS C, ADMIN_ORDER D
	  WHERE A.ORDER_NUM=B.ORDER_NUM AND B.GOODS_NUM =C.GOODS_NUM AND D.ORDER_NUM = A.ORDER_NUM AND D.AORDER_STATE ='구매확정' AND ORDER_PAY=#{ORDER_PAY}
	  GROUP BY C.GOODS_NAME
	</select>
	
</mapper>